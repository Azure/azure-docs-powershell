### YamlMime:PowershellCmdlet
summary: |-
  Adds or updates a V2 (non-classic) metric-based alert rule.
module: Az.Monitor
notes: ""
inputs:
- name: <xref href="System.String" data-throw-if-not-resolved="False" />
  description: ""
- name: <xref href="System.TimeSpan" data-throw-if-not-resolved="False" />
  description: ""
- name: <xref href="System.String" data-throw-if-not-resolved="False" /><span>[</span><span>]</span>
  description: ""
- name: <xref href="System.Collections.Generic.List`1" data-throw-if-not-resolved="False" /><span>[</span><xref href="" data-throw-if-not-resolved="False" /><span>[</span><xref href="Microsoft.Azure.Commands.Insights.OutputClasses.IPSMultiMetricCriteria, Microsoft.Azure.PowerShell.Cmdlets.Monitor, Version=1.0.1.0, Culture=neutral, PublicKeyToken=null" data-throw-if-not-resolved="False" /><span>]</span><span>]</span>
  description: ""
- name: <xref href="Microsoft.Azure.Management.Monitor.Models.ActivityLogAlertActionGroup" data-throw-if-not-resolved="False" /><span>[</span><span>]</span>
  description: ""
- name: <xref href="System.Management.Automation.SwitchParameter" data-throw-if-not-resolved="False" />
  description: ""
- name: <xref href="System.Int32" data-throw-if-not-resolved="False" />
  description: ""
outputs:
- name: <xref href="Microsoft.Azure.Commands.Insights.OutputClasses.PSMetricAlertRuleV2" data-throw-if-not-resolved="False" />
  description: ""
syntaxes:
- >-
  Add-AzMetricAlertRuleV2 -Name <String> -ResourceGroupName <String> -WindowSize <TimeSpan> -Frequency <TimeSpan>

   -TargetResourceId <String>

   -Condition <System.Collections.Generic.List`1[Microsoft.Azure.Commands.Insights.OutputClasses.IPSMultiMetricCriteria]>

   [-ActionGroup <ActivityLogAlertActionGroup[]>] [-ActionGroupId <String[]>] [-DisableRule]

   [-Description <String>] -Severity <Int32> [-DefaultProfile <IAzureContextContainer>] [-WhatIf] [-Confirm]

   [<CommonParameters>]
- >-
  Add-AzMetricAlertRuleV2 -Name <String> -ResourceGroupName <String> -WindowSize <TimeSpan> -Frequency <TimeSpan>

   -TargetResourceScope <String[]> -TargetResourceType <String> -TargetResourceRegion <String>

   -Condition <System.Collections.Generic.List`1[Microsoft.Azure.Commands.Insights.OutputClasses.IPSMultiMetricCriteria]>

   [-ActionGroup <ActivityLogAlertActionGroup[]>] [-ActionGroupId <String[]>] [-DisableRule]

   [-Description <String>] -Severity <Int32> [-DefaultProfile <IAzureContextContainer>] [-WhatIf] [-Confirm]

   [<CommonParameters>]
examples:
- title: 'Example 1: Add a metric alert rule to a virtual machine'
  code: |-
    PS C:\> Add-AzMetricAlertRuleV2 -Name PS3182019 -ResourceGroupName xxxxRG -WindowSize 0:5 -Frequency 0:5 -TargetResourceScope "/subscriptions/00000000-0000-0000-0000-0000000/resourceGroups/012345/providers/Microsoft.Compute/virtualMachines/VM1", "/subscriptions/00000000-0000-0000-0000-0000000/resourceGroups/012345/providers/Microsoft.Compute/virtualMachines/VM2" -TargetResourceType "Microsoft.Compute/virtualMachines" -TargetResourceRegion "eastus" -Description "This is description" -Severity 4 -ActionGroup $act -Condition $condition

    Description          : This is description
    Severity             : 4
    Enabled              : True
    Scopes               : {/subscriptions/00000000-0000-0000-0000-0000000/resourceGroups/012345/providers/Microsoft.Compute/virtualMachines/VM1,
                           /subscriptions/00000000-0000-0000-0000-0000000/resourceGroups/012345/providers/Microsoft.Compute/virtualMachines/VM2}
    EvaluationFrequency  : 00:05:00
    WindowSize           : 00:05:00
    TargetResourceType   : Microsoft.Compute/virtualMachines
    TargetResourceRegion : eastus
    Criteria             : Microsoft.Azure.Management.Monitor.Models.MetricAlertMultipleResourceMultipleMetricCriteria
    AutoMitigate         :
    Actions              : {/subscriptions/00000000-0000-0000-0000-0000000/resourcegroups/default-activitylogalerts/providers/microsoft.insights/actiongroups/demo}
    LastUpdatedTime      :
    Id                   : /subscriptions/00000000-0000-0000-0000-0000000/resourceGroups/xxxxRG/providers/Microsoft.Insights/metricAlerts/PS3182019
    Name                 : PS3182019
    Type                 : Microsoft.Insights/metricAlerts
    Location             : global
    Tags                 :
  description: |-
    This command creates a metric alert rule for a virtual machine. $condition is the output of New-AzMetricAlertRuleV2Criteria cmdlet and $act is the output of New-AzActionGroup cmdlet
  summary: ""
- title: 'Example 2: Add a metric alert rule for all virtual machines in a subscription'
  code: |-
    PS C:\> Add-AzMetricAlertRuleV2 -Name AllVM -ResourceGroupName xxxxRG -WindowSize 0:5 -Frequency 0:5 -TargetResourceScope "/subscriptions/00000000-0000-0000-0000-0000000" -TargetResourceType "Microsoft.Compute/virtualMachines" -TargetResourceRegion "eastus" -Description "This is description" -Severity 4 -ActionGroup $act -Condition $condition

    Description          : This is description
    Severity             : 4
    Enabled              : True
    Scopes               : {/subscriptions/00000000-0000-0000-0000-0000000}
    EvaluationFrequency  : 00:05:00
    WindowSize           : 00:05:00
    TargetResourceType   : Microsoft.Compute/virtualMachines
    TargetResourceRegion : eastus
    Criteria             : Microsoft.Azure.Management.Monitor.Models.MetricAlertMultipleResourceMultipleMetricCriteria
    AutoMitigate         :
    Actions              : {/subscriptions/00000000-0000-0000-0000-0000000/resourcegroups/default-activitylogalerts/providers/microsoft.insights/actiongroups/demo}
    LastUpdatedTime      :
    Id                   : /subscriptions/00000000-0000-0000-0000-0000000/resourceGroups/xxxxRG/providers/Microsoft.Insights/metricAlerts/AllVM
    Name                 : AllVM
    Type                 : Microsoft.Insights/metricAlerts
    Location             : global
    Tags                 :
  description: |-
    This command creates a metric alert rule for all virtual machines in the subscription that are in eastus
  summary: ""
- title: 'Example 3: Disable a metric alert rule'
  code: |-
    PS C:\>Get-AzMetricAlertRuleV2 -ResourceGroupName alertstest  -Name TestAlertRule | Add-AzMetricAlertRuleV2 -DisableRule
    Description          : This new Metric alert rule was created from Powershell version: 1.0.1
    Severity             : 4
    Enabled              : False
    Scopes               : {/subscriptions/00000000-0000-0000-0000-0000000/resourceGroups/alertstest/providers/microsoft.insights/components/alertstestFunction}
    EvaluationFrequency  : 00:05:00
    WindowSize           : 00:05:00
    TargetResourceType   :
    TargetResourceRegion :
    Criteria             : Microsoft.Azure.Management.Monitor.Models.MetricAlertSingleResourceMultipleMetricCriteria
    AutoMitigate         :
    Actions              : {/subscriptions/00000000-0000-0000-0000-0000000/resourcegroups/default-activitylogalerts/providers/microsoft.insights/actiongroups/demo1}
    LastUpdatedTime      :
    Id                   : /subscriptions/00000000-0000-0000-0000-0000000/resourceGroups/alertstest/providers/Microsoft.Insights/metricAlerts/TestAlertRule
    Name                 : TestAlertRule
    Type                 : Microsoft.Insights/metricAlerts
    Location             : global
    Tags                 :
  description: |-
    This command disables a metric alert rule. Here, we are piping output of Get-AzMetricAlertRuleV2 to Add-AzMetricAlertRuleV2
  summary: ""
- title: 'Example 4: Add a metric alert rule with dimensions'
  code: |-
    PS C:\>$act = New-AzActionGroup -ActionGroupId "/subscriptions/00000000-0000-0000-0000-0000000/resourcegroups/default-activitylogalerts/providers/microsoft.insights/actiongroups/actionGroupDemo"
    PS C:\>$dim1 = New-AzMetricAlertRuleV2DimensionSelection -DimensionName "availabilityResult/name" -ValuesToInclude "gdtest"
    PS C:\>$dim2 = New-AzMetricAlertRuleV2DimensionSelection -DimensionName "availabilityResult/location" -ValuesToInclude "*"
    PS C:\>$criteria = New-AzMetricAlertRuleV2Criteria -MetricName "availabilityResults/availabilityPercentage" -DimensionSelection $dim1,$dim2 -TimeAggregation Average -Operator GreaterThan -Threshold 2
    PS C:\>Add-AzMetricAlertRuleV2 -Name AlertWithDim -ResourceGroupName alertstest -WindowSize 00:05:00 -Frequency 00:05:00 -TargetResourceId "/subscriptions/00000000-0000-0000-0000-0000000/resourceGroups/alertstest/providers/microsoft.insights/components/alertstestFunction" -Condition $criteria -ActionGroup $act -DisableRule -Severity 4
    Description          : This new Metric alert rule was created from Powershell version: 1.0.0
    Severity             : 4
    Enabled              : False
    Scopes               : {/subscriptions/00000000-0000-0000-0000-0000000/resourceGroups/alertstest/providers/microsoft.insights/components/alertstestFunction}
    EvaluationFrequency  : 00:05:00
    WindowSize           : 00:05:00
    TargetResourceType   :
    TargetResourceRegion :
    Criteria             : Microsoft.Azure.Management.Monitor.Models.MetricAlertSingleResourceMultipleMetricCriteria
    AutoMitigate         :
    Actions              : {/subscriptions/00000000-0000-0000-0000-0000000/resourcegroups/default-activitylogalerts/providers/microsoft.insights/actiongroups/actionGroupDemo}
    LastUpdatedTime      :
    Id                   : /subscriptions/00000000-0000-0000-0000-0000000/resourceGroups/alertstest/providers/Microsoft.Insights/metricAlerts/AlertWithDim
    Name                 : AlertWithDim
    Type                 : Microsoft.Insights/metricAlerts
    Location             : global
    Tags                 :
  description: |-
    To create a more complex metric alert rule like the ones that involve selecting dimension values or have multiple criteria, you can use the helper cmdlets New-AzMetricAlertRuleV2DimensionSelection and New-AzMetricAlertRuleV2Criteria.

    Above set of cmdlets will create a metric alert rule with dimensions.
  summary: ""
parameters:
- type: <xref href="Microsoft.Azure.Management.Monitor.Models.ActivityLogAlertActionGroup" data-throw-if-not-resolved="False" /><span>[</span><span>]</span>
  name: ActionGroup
  description: |+
    The Action Group for rule

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: Actions
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" /><span>[</span><span>]</span>
  name: ActionGroupId
  description: |+
    The Action Group id for rule

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.Collections.Generic.List`1" data-throw-if-not-resolved="False" /><span>[</span><xref href="Microsoft.Azure.Commands.Insights.OutputClasses.IPSMultiMetricCriteria" data-throw-if-not-resolved="False" /><span>]</span>
  name: Condition
  isRequired: true
  description: |+
    The condition for rule

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: Criteria
  parameterValueGroup: ""
- type: <xref href="System.Management.Automation.SwitchParameter" data-throw-if-not-resolved="False" />
  name: Confirm
  description: |+
    Prompts you for confirmation before running the cmdlet.

  defaultValue: None
  position: Named
  aliases: cf
  parameterValueGroup: ""
- type: <xref href="Microsoft.Azure.Commands.Common.Authentication.Abstractions.Core.IAzureContextContainer" data-throw-if-not-resolved="False" />
  name: DefaultProfile
  description: |+
    The credentials, account, tenant, and subscription used for communication with Azure.

  defaultValue: None
  position: Named
  aliases: AzContext, AzureRmContext, AzureCredential
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: Description
  description: |+
    The description of the metric alert rule

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.Management.Automation.SwitchParameter" data-throw-if-not-resolved="False" />
  name: DisableRule
  description: |+
    The disable rule (status) flag

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.TimeSpan" data-throw-if-not-resolved="False" />
  name: Frequency
  isRequired: true
  description: |+
    The evaluation frequency for rule

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: EvaluationFrequency
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: Name
  isRequired: true
  description: |+
    The name of metric alert rule

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: ResourceGroupName
  isRequired: true
  description: |+
    The Resource Group Name

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: ResourceGroup
  parameterValueGroup: ""
- type: <xref href="System.Int32" data-throw-if-not-resolved="False" />
  name: Severity
  isRequired: true
  description: |+
    The severity for the metric alert rule

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: TargetResourceId
  isRequired: true
  description: |+
    The target resource id for rule

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: TargetResourceRegion
  isRequired: true
  description: |+
    The target resource region for rule

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" /><span>[</span><span>]</span>
  name: TargetResourceScope
  isRequired: true
  description: |+
    The target resource scope for rule

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: Scopes
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: TargetResourceType
  isRequired: true
  description: |+
    The target resource type for rule

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.Management.Automation.SwitchParameter" data-throw-if-not-resolved="False" />
  name: WhatIf
  description: |+
    Shows what would happen if the cmdlet runs.
    The cmdlet is not run.

  defaultValue: None
  position: Named
  aliases: wi
  parameterValueGroup: ""
- type: <xref href="System.TimeSpan" data-throw-if-not-resolved="False" />
  name: WindowSize
  isRequired: true
  description: |+
    The window size for rule

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: ""
  parameterValueGroup: ""
uid: Az.Monitor.Add-AzMetricAlertRuleV2
name: Add-AzMetricAlertRuleV2
description: |-
  Adds or updates a **V2 (non-classic) metric-based alert rule**. The added rule is associated with a resource group and has a name. This cmdlet implements the ShouldProcess pattern, i.e. it might request confirmation from the user before actually creating, modifying, or removing the resource.
metadata:
  external help file: Microsoft.Azure.PowerShell.Cmdlets.Monitor.dll-Help.xml
  Module Name: Az.Monitor
  online version: https://docs.microsoft.com/en-us/powershell/module/az.monitor/add-azmetricalertrulev2
  schema: 2.0.0
  content_git_url: https://github.com/Azure/azure-powershell/blob/master/src/Monitor/Monitor/help/Add-AzMetricAlertRuleV2.md
  original_content_git_url: https://github.com/Azure/azure-powershell/blob/master/src/Monitor/Monitor/help/Add-AzMetricAlertRuleV2.md
