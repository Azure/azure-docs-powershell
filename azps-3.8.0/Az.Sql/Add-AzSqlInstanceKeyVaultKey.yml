### YamlMime:PowershellCmdlet
summary: |-
  Adds a key vault key to the provided Managed Instance.
module: Az.Sql
notes: ""
inputs:
- name: <xref href="Microsoft.Azure.Commands.Sql.ManagedInstance.Model.AzureSqlManagedInstanceModel" data-throw-if-not-resolved="False" />
  description: |-
    System.String
outputs:
- name: <xref href="Microsoft.Azure.Commands.Sql.TransparentDataEncryption.Model.AzureRmSqlManagedInstanceKeyVaultKeyModel" data-throw-if-not-resolved="False" />
  description: ""
syntaxes:
- >-
  Add-AzSqlInstanceKeyVaultKey [-ResourceGroupName] <String> [-InstanceName] <String> [-KeyId] <String>

   [-DefaultProfile <IAzureContextContainer>] [-WhatIf] [-Confirm] [<CommonParameters>]
- >-
  Add-AzSqlInstanceKeyVaultKey [-Instance] <AzureSqlManagedInstanceModel> [-KeyId] <String>

   [-DefaultProfile <IAzureContextContainer>] [-WhatIf] [-Confirm] [<CommonParameters>]
- >-
  Add-AzSqlInstanceKeyVaultKey [-InstanceResourceId] <String> [-KeyId] <String>

   [-DefaultProfile <IAzureContextContainer>] [-WhatIf] [-Confirm] [<CommonParameters>]
examples:
- title: Example 1
  code: |-
    PS C:\> Add-AzSqlInstanceKeyVaultKey -ResourceGroupName 'ContosoResourceGroup' -InstanceName 'ContosoManagedInstanceName' -KeyId 'https://contoso.vault.azure.net/keys/contosokey/01234567890123456789012345678901'

    ResourceGroupName      : ContosoResourceGroup
    ManagedInstanceName    : ContosoManagedInstanceName
    KeyId                  : https://contoso.vault.azure.net/keys/contosokey/01234567890123456789012345678901
    ManagedInstanceKeyName : contoso_contosokey_01234567890123456789012345678901
    CreationDate           : 9/1/2018 12:11:49 AM
    Thumbprint             : 6AB10000F99E1B6A22222F39E3F11CB5DC5A55A1
    Type                   : AzureKeyVault
  description: |-
    This command adds the Key Vault key with Id 'https://contoso.vault.azure.net/keys/contosokey/01234567890123456789012345678901' to the SQL managed instance named 'ContosoManagedInstanceName' in the resource group 'ContosoResourceGroup'.
  summary: ""
- title: 'Example 2: Using managed instance object'
  code: |-
    PS C:\> $managedInstance = Get-AzSqlInstance -Name 'ContosoManagedInstanceName' -ResourceGroupName 'ContosoResourceGroup'
    PS C:\> Add-AzSqlInstanceKeyVaultKey -Instance $managedInstance -KeyId 'https://contoso.vault.azure.net/keys/contosokey/01234567890123456789012345678901'

    ResourceGroupName      : ContosoResourceGroup
    ManagedInstanceName    : ContosoManagedInstanceName
    KeyId                  : https://contoso.vault.azure.net/keys/contosokey/01234567890123456789012345678901
    ManagedInstanceKeyName : contoso_contosokey_01234567890123456789012345678901
    CreationDate           : 9/1/2018 12:11:49 AM
    Thumbprint             : 6AB10000F99E1B6A22222F39E3F11CB5DC5A55A1
    Type                   : AzureKeyVault
  description: |-
    This command adds the Key Vault key with Id 'https://contoso.vault.azure.net/keys/contosokey/01234567890123456789012345678901' to the SQL managed instance named 'ContosoManagedInstanceName' in the resource group 'ContosoResourceGroup'.
  summary: ""
- title: 'Example 3: Using managed instance resource id'
  code: |-
    PS C:\> $managedInstance = Get-AzSqlInstance -Name 'ContosoManagedInstanceName' -ResourceGroupName 'ContosoResourceGroup'
    PS C:\> Add-AzSqlInstanceKeyVaultKey -InstanceResourceId $managedInstance.ResourceId -KeyId 'https://contoso.vault.azure.net/keys/contosokey/01234567890123456789012345678901'

    ResourceGroupName      : ContosoResourceGroup
    ManagedInstanceName    : ContosoManagedInstanceName
    KeyId                  : https://contoso.vault.azure.net/keys/contosokey/01234567890123456789012345678901
    ManagedInstanceKeyName : contoso_contosokey_01234567890123456789012345678901
    CreationDate           : 9/1/2018 12:11:49 AM
    Thumbprint             : 6AB10000F99E1B6A22222F39E3F11CB5DC5A55A1
    Type                   : AzureKeyVault
  description: |-
    This command adds the Key Vault key with Id 'https://contoso.vault.azure.net/keys/contosokey/01234567890123456789012345678901' to the SQL managed instance named 'ContosoManagedInstanceName' in the resource group 'ContosoResourceGroup'.
  summary: ""
- title: 'Example 4: Using piping'
  code: |-
    PS C:\> $managedInstance = Get-AzSqlInstance -Name 'ContosoManagedInstanceName' -ResourceGroupName 'ContosoResourceGroup'
    PS C:\> $managedInstance | Add-AzSqlInstanceKeyVaultKey -KeyId 'https://contoso.vault.azure.net/keys/contosokey/01234567890123456789012345678901'

    ResourceGroupName      : ContosoResourceGroup
    ManagedInstanceName    : ContosoManagedInstanceName
    KeyId                  : https://contoso.vault.azure.net/keys/contosokey/01234567890123456789012345678901
    ManagedInstanceKeyName : contoso_contosokey_01234567890123456789012345678901
    CreationDate           : 9/1/2018 12:11:49 AM
    Thumbprint             : 6AB10000F99E1B6A22222F39E3F11CB5DC5A55A1
    Type                   : AzureKeyVault
  description: |-
    This command adds the Key Vault key with Id 'https://contoso.vault.azure.net/keys/contosokey/01234567890123456789012345678901' to the SQL managed instance named 'ContosoManagedInstanceName' in the resource group 'ContosoResourceGroup'.
  summary: ""
parameters:
- type: <xref href="System.Management.Automation.SwitchParameter" data-throw-if-not-resolved="False" />
  name: Confirm
  description: |+
    Prompts you for confirmation before running the cmdlet.

  defaultValue: None
  position: Named
  aliases: cf
  parameterValueGroup: ""
- type: <xref href="Microsoft.Azure.Commands.Common.Authentication.Abstractions.Core.IAzureContextContainer" data-throw-if-not-resolved="False" />
  name: DefaultProfile
  description: |+
    The credentials, account, tenant, and subscription used for communication with Azure.

  defaultValue: None
  position: Named
  aliases: AzContext, AzureRmContext, AzureCredential
  parameterValueGroup: ""
- type: <xref href="Microsoft.Azure.Commands.Sql.ManagedInstance.Model.AzureSqlManagedInstanceModel" data-throw-if-not-resolved="False" />
  name: Instance
  isRequired: true
  description: |+
    The instance input object

  defaultValue: None
  pipelineInput: true
  position: "0"
  aliases: InputObject
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: InstanceName
  isRequired: true
  description: |+
    The instance name

  defaultValue: None
  position: "1"
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: InstanceResourceId
  isRequired: true
  description: |+
    The instance resource id

  defaultValue: None
  pipelineInput: true
  position: "0"
  aliases: ResourceId
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: KeyId
  isRequired: true
  description: |+
    AzureKeyVault key id

  defaultValue: None
  position: "1"
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: ResourceGroupName
  isRequired: true
  description: |+
    The Resource Group Name

  defaultValue: None
  position: "0"
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.Management.Automation.SwitchParameter" data-throw-if-not-resolved="False" />
  name: WhatIf
  description: |+
    Shows what would happen if the cmdlet runs.
    The cmdlet is not run.

  defaultValue: None
  position: Named
  aliases: wi
  parameterValueGroup: ""
uid: Az.Sql.Add-AzSqlInstanceKeyVaultKey
name: Add-AzSqlInstanceKeyVaultKey
description: |-
  The Add-AzSqlInstanceKeyVaultKey cmdlet adds a key vault key to the provided Managed Instance. The managed instance must have 'get, wrapKey, unwrapKey' permissions to the vault, use the following script to grant permission to the managed instance.
  $managedInstance = Get-AzSqlInstance -Name 'ContosoManagedInstanceName' -ResourceGroupName 'ContosoResourceGroup'
  Set-AzKeyVaultAccessPolicy -VaultName ContosoVault -ObjectId $managedInstance.Identity.PrincipalId -PermissionsToKeys get, wrapKey, unwrapKey
metadata:
  external help file: Microsoft.Azure.PowerShell.Cmdlets.Sql.dll-Help.xml
  Module Name: Az.Sql
  online version: https://docs.microsoft.com/en-us/powershell/module/az.sql/Add-AzSqlInstanceKeyVaultKey
  schema: 2.0.0
  content_git_url: https://github.com/Azure/azure-powershell/blob/master/src/Sql/Sql/help/Add-AzSqlInstanceKeyVaultKey.md
  original_content_git_url: https://github.com/Azure/azure-powershell/blob/master/src/Sql/Sql/help/Add-AzSqlInstanceKeyVaultKey.md
