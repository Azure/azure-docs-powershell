### YamlMime:PowershellCmdlet
summary: |-
  Gets policy compliance states for resources.
module: Az.PolicyInsights
notes: ""
inputs:
- name: <xref href="System.String" data-throw-if-not-resolved="False" />
  description: ""
outputs:
- name: <xref href="Microsoft.Azure.Commands.PolicyInsights.Models.PolicyState" data-throw-if-not-resolved="False" />
  description: ""
links:
- text: Get-AzPolicyStateSummary
  href: ./Get-AzPolicyStateSummary.yml
syntaxes:
- >-
  Get-AzPolicyState [-All] [-SubscriptionId <String>] [-Top <Int32>] [-OrderBy <String>] [-Select <String>]

   [-From <DateTime>] [-To <DateTime>] [-Filter <String>] [-Apply <String>]

   [-DefaultProfile <IAzureContextContainer>] [<CommonParameters>]
- >-
  Get-AzPolicyState [-All] -ManagementGroupName <String> [-Top <Int32>] [-OrderBy <String>] [-Select <String>]

   [-From <DateTime>] [-To <DateTime>] [-Filter <String>] [-Apply <String>]

   [-DefaultProfile <IAzureContextContainer>] [<CommonParameters>]
- >-
  Get-AzPolicyState [-All] [-SubscriptionId <String>] -ResourceGroupName <String> [-Top <Int32>]

   [-OrderBy <String>] [-Select <String>] [-From <DateTime>] [-To <DateTime>] [-Filter <String>]

   [-Apply <String>] [-DefaultProfile <IAzureContextContainer>] [<CommonParameters>]
- >-
  Get-AzPolicyState [-All] -ResourceId <String> [-Top <Int32>] [-OrderBy <String>] [-Select <String>]

   [-From <DateTime>] [-To <DateTime>] [-Filter <String>] [-Apply <String>]

   [-DefaultProfile <IAzureContextContainer>] [<CommonParameters>]
- >-
  Get-AzPolicyState [-All] [-SubscriptionId <String>] -PolicySetDefinitionName <String> [-Top <Int32>]

   [-OrderBy <String>] [-Select <String>] [-From <DateTime>] [-To <DateTime>] [-Filter <String>]

   [-Apply <String>] [-DefaultProfile <IAzureContextContainer>] [<CommonParameters>]
- >-
  Get-AzPolicyState [-All] [-SubscriptionId <String>] -PolicyDefinitionName <String> [-Top <Int32>]

   [-OrderBy <String>] [-Select <String>] [-From <DateTime>] [-To <DateTime>] [-Filter <String>]

   [-Apply <String>] [-DefaultProfile <IAzureContextContainer>] [<CommonParameters>]
- >-
  Get-AzPolicyState [-All] [-SubscriptionId <String>] -PolicyAssignmentName <String> [-Top <Int32>]

   [-OrderBy <String>] [-Select <String>] [-From <DateTime>] [-To <DateTime>] [-Filter <String>]

   [-Apply <String>] [-DefaultProfile <IAzureContextContainer>] [<CommonParameters>]
- >-
  Get-AzPolicyState [-All] [-SubscriptionId <String>] -ResourceGroupName <String> -PolicyAssignmentName <String>

   [-Top <Int32>] [-OrderBy <String>] [-Select <String>] [-From <DateTime>] [-To <DateTime>] [-Filter <String>]

   [-Apply <String>] [-DefaultProfile <IAzureContextContainer>] [<CommonParameters>]
examples:
- title: 'Example 1: Get latest policy states in current subscription scope'
  code: |-
    PS C:\> Get-AzPolicyState
  description: |-
    Gets latest policy state records generated in the last day for all resources within the subscription in current session context.
  summary: ""
- title: 'Example 2: Get latest policy states in the specified subscription scope'
  code: |-
    PS C:\> Get-AzPolicyState -SubscriptionId "fff10b27-fff3-fff5-fff8-fffbe01e86a5"
  description: |-
    Gets latest policy state records generated in the last day for all resources within the specified subscription.
  summary: ""
- title: 'Example 3: Get all policy states in current subscription scope'
  code: |-
    PS C:\> Get-AzPolicyState -All
  description: |-
    Gets all historical policy state records (including latest) generated in the last day for all resources within the subscription in current session context.
  summary: ""
- title: 'Example 4: Get latest policy states in management group scope'
  code: |-
    PS C:\> Get-AzPolicyState -ManagementGroupName "myManagementGroup"
  description: |-
    Gets latest policy state records generated in the last day for all resources within the specified management group.
  summary: ""
- title: 'Example 5: Get latest policy states in resource group scope in current subscription'
  code: |-
    PS C:\> Get-AzPolicyState -ResourceGroupName "myResourceGroup"
  description: |-
    Gets latest policy state records generated in the last day for all resources within the specified resource group (in the subscription in current session context).
  summary: ""
- title: 'Example 6: Get latest policy states in resource group scope in the specified subscription'
  code: |-
    PS C:\> Get-AzPolicyState -SubscriptionId "fff10b27-fff3-fff5-fff8-fffbe01e86a5" -ResourceGroupName "myResourceGroup"
  description: |-
    Gets latest policy state records generated in the last day for all resources within the specified resource group (in the specified subscription).
  summary: ""
- title: 'Example 7: Get latest policy states for a resource'
  code: |-
    PS C:\> Get-AzPolicyState -ResourceId "/subscriptions/fff10b27-fff3-fff5-fff8-fffbe01e86a5/resourceGroups/myResourceGroup/providers/Microsoft.EventHub/namespaces/myns1/eventhubs/eh1/consumergroups/cg1"
  description: |-
    Gets latest policy state records generated in the last day for the specified resource.
  summary: ""
- title: 'Example 8: Get latest policy states for a policy set definition in current subscription'
  code: |-
    PS C:\> Get-AzPolicyState -PolicySetDefinitionName "fff58873-fff8-fff5-fffc-fffbe7c9d697"
  description: |-
    Gets latest policy state records generated in the last day for all resources (within the tenant in current session context) effected by the specified policy set definition (that exists in the subscription in current session context).
  summary: ""
- title: 'Example 9: Get latest policy states for a policy set definition in the specified subscription'
  code: |-
    PS C:\> Get-AzPolicyState -SubscriptionId "fff10b27-fff3-fff5-fff8-fffbe01e86a5" -PolicySetDefinitionName "fff58873-fff8-fff5-fffc-fffbe7c9d697"
  description: |-
    Gets latest policy state records generated in the last day for all resources (within the tenant in current session context) effected by the specified policy set definition (that exists in the specified subscription).
  summary: ""
- title: 'Example 10: Get latest policy states for a policy definition in current subscription'
  code: |-
    PS C:\> Get-AzPolicyState -PolicyDefinitionName "fff58873-fff8-fff5-fffc-fffbe7c9d697"
  description: |-
    Gets latest policy state records generated in the last day for all resources (within the tenant in current session context) effected by the specified policy definition (that exists in the subscription in current session context).
  summary: ""
- title: 'Example 11: Get latest policy states for a policy definition in the specified subscription'
  code: |-
    PS C:\> Get-AzPolicyState -SubscriptionId "fff10b27-fff3-fff5-fff8-fffbe01e86a5" -PolicyDefinitionName "fff58873-fff8-fff5-fffc-fffbe7c9d697"
  description: |-
    Gets latest policy state records generated in the last day for all resources (within the tenant in current session context) effected by the specified policy definition (that exists in the specified subscription).
  summary: ""
- title: 'Example 12: Get latest policy states for a policy assignment in current subscription'
  code: |-
    PS C:\> Get-AzPolicyState -PolicyAssignmentName "ddd8ef92e3714a5ea3d208c1"
  description: |-
    Gets latest policy state records generated in the last day for all resources (within the tenant in current session context) effected by the specified policy assignment (that exists in the subscription in current session context).
  summary: ""
- title: 'Example 13: Get latest policy states for a policy assignment in the specified subscription'
  code: |-
    PS C:\> Get-AzPolicyState -SubscriptionId "fff10b27-fff3-fff5-fff8-fffbe01e86a5" -PolicyAssignmentName "ddd8ef92e3714a5ea3d208c1"
  description: |-
    Gets latest policy state records generated in the last day for all resources (within the tenant in current session context) effected by the specified policy assignment (that exists in the specified subscription).
  summary: ""
- title: 'Example 14: Get latest policy states for a policy assignment in the specified resource group in the current subscription'
  code: |-
    PS C:\> Get-AzPolicyState -ResourceGroupName "myResourceGroup" -PolicyAssignmentName "ddd8ef92e3714a5ea3d208c1"
  description: |-
    Gets latest policy state records generated in the last day for all resources (within the tenant in current session context) effected by the specified policy assignment (that exists in the resource group in the subscription in current session context).
  summary: ""
- title: 'Example 15: Get latest policy states in current subscription scope, with OrderBy, Top and Select query options'
  code: |-
    PS C:\> Get-AzPolicyState -OrderBy "Timestamp desc, PolicyAssignmentName asc" -Top 5 -Select "Timestamp, ResourceId, PolicyAssignmentId, PolicySetDefinitionId, PolicyDefinitionId, IsCompliant"
  description: |-
    Gets latest policy state records generated in the last day for all resources within the subscription in current session context. 
    The command orders the results by timestamp and policy assignment name properties, and takes only top 5 of those listed in that order.
    It also selects to list only a subset of the columns for each record.
  summary: ""
- title: 'Example 16: Get latest policy states in current subscription scope, with From and To query options'
  code: |-
    PS C:\> Get-AzPolicyState -From "2018-03-08 00:00:00Z" -To "2018-03-15 00:00:00Z"
  description: |-
    Gets latest policy state records generated within the date range specified for all resources within the subscription in current session context.
  summary: ""
- title: 'Example 17: Get latest policy states in current subscription scope, with Filter query option'
  code: |-
    PS C:\> Get-AzPolicyState -Filter "(PolicyDefinitionAction eq 'deny' or PolicyDefinitionAction eq 'audit') and IsCompliant eq false and ResourceLocation ne 'eastus'"
  description: |-
    Gets latest policy state records generated in the last day for all resources within the subscription in current session context.
    The command limits the results returned by filtering based on policy definition action (includes deny or audit actions), compliance status (includes only non-compliant status) and resource location (excludes eastus location).
  summary: ""
- title: 'Example 18: Get latest policy states in current subscription scope, with Apply specifying row count aggregation'
  code: |-
    PS C:\> Get-AzPolicyState -Apply "aggregate(`$count as NumberOfRecords)"
  description: |-
    Gets the number of latest policy state records generated in the last day for all resources within the subscription in current session context.
    The command returns the count of the policy state records only, which is returned inside AdditionalProperties property.
  summary: ""
- title: 'Example 19: Get latest policy states in current subscription scope, with Apply specifying grouping with aggregation'
  code: |-
    PS C:\> Get-AzPolicyState -Filter "IsCompliant eq false" -Apply "groupby((PolicyAssignmentId, PolicySetDefinitionId, PolicyDefinitionReferenceId, PolicyDefinitionId), aggregate(`$count as NumStates))" -OrderBy "NumStates desc" -Top 5
  description: |-
    Gets latest policy state records generated in the last day for all resources within the subscription in current session context. 
    The command limits the results returned by filtering based on compliance status (includes only non-compliant status).
    It groups the results based on policy assignment, policy set definition, and policy definition, and computes the number of records in each group, which is returned inside AdditionalProperties property.
    It orders the results by the count aggregation in descending order, and takes only top 5 of those listed in that order.
  summary: ""
- title: 'Example 20: Get latest policy states in current subscription scope, with Apply specifying grouping without aggregation'
  code: |-
    PS C:\> Get-AzPolicyState -Filter "IsCompliant eq false" -Apply "groupby((ResourceId))"
  description: |-
    Gets latest policy state records generated in the last day for all resources within the subscription in current session context. 
    The command limits the results returned by filtering based on compliance status (includes only non-compliant status).
    It groups the results based on resource id.
    This generates the list of all resources within the subscription that are non-compliant for at least one policy.
  summary: ""
- title: 'Example 21: Get latest policy states in current subscription scope, with Apply specifying multiple groupings'
  code: |-
    PS C:\> Get-AzPolicyState -Filter "IsCompliant eq false" -Apply "groupby((PolicyAssignmentId, PolicySetDefinitionId, PolicyDefinitionReferenceId, PolicyDefinitionId, ResourceId))/groupby((PolicyAssignmentId, PolicySetDefinitionId, PolicyDefinitionReferenceId, PolicyDefinitionId), aggregate(`$count as NumNonCompliantResources))" -OrderBy "NumNonCompliantResources desc" -Top 5
  description: |-
    Gets latest policy state records generated in the last day for all resources within the subscription in current session context. 
    The command limits the results returned by filtering based on compliance status (includes only non-compliant status).
    It groups the results first based on policy assignment, policy set definition, policy definition, and resource id. 
    Then, it further groups the results of this grouping with the same properties except for resource id, and computes the number of records in each of these groups, which is returned inside AdditionalProperties property.
    It orders the results by the count aggregation in descending order, and takes only top 5 of those listed in that order.
    This generates the top 5 policies with the most number of non-compliant resources.
  summary: ""
parameters:
- type: <xref href="System.Management.Automation.SwitchParameter" data-throw-if-not-resolved="False" />
  name: All
  description: |+
    Within the specified time interval, get all policy states instead of the latest only.

  defaultValue: None
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: Apply
  description: |+
    Apply expression for aggregations using OData notation.

  defaultValue: None
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="Microsoft.Azure.Commands.Common.Authentication.Abstractions.Core.IAzureContextContainer" data-throw-if-not-resolved="False" />
  name: DefaultProfile
  description: |+
    The credentials, account, tenant, and subscription used for communication with Azure.

  defaultValue: None
  position: Named
  aliases: AzContext, AzureRmContext, AzureCredential
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: Filter
  description: |+
    Filter expression using OData notation.

  defaultValue: None
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.DateTime" data-throw-if-not-resolved="False" />
  name: From
  description: |+
    ISO 8601 formatted timestamp specifying the start time of the interval to query.
    When not specified, defaults to 'To' parameter value minus 1 day.

  defaultValue: None
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: ManagementGroupName
  isRequired: true
  description: |+
    Management group name.

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: OrderBy
  description: |+
    Ordering expression using OData notation.
    One or more comma-separated column names with an optional 'desc' (the default) or 'asc'.

  defaultValue: None
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: PolicyAssignmentName
  isRequired: true
  description: |+
    Policy assignment name.

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: PolicyDefinitionName
  isRequired: true
  description: |+
    Policy definition name.

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: PolicySetDefinitionName
  isRequired: true
  description: |+
    Policy set definition name.

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: ResourceGroupName
  isRequired: true
  description: |+
    Resource group name.

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: ResourceId
  isRequired: true
  description: |+
    Resource ID.

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: Select
  description: |+
    Select expression using OData notation.
    One or more comma-separated column names.
    Limits the columns on each record to just those requested.

  defaultValue: None
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: SubscriptionId
  description: |+
    Subscription ID.

  defaultValue: None
  pipelineInput: true
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.DateTime" data-throw-if-not-resolved="False" />
  name: To
  description: |+
    ISO 8601 formatted timestamp specifying the end time of the interval to query.
    When not specified, defaults to time of request.

  defaultValue: None
  position: Named
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.Int32" data-throw-if-not-resolved="False" />
  name: Top
  description: |+
    Maximum number of records to return.

  defaultValue: None
  position: Named
  aliases: ""
  parameterValueGroup: ""
uid: Az.PolicyInsights.Get-AzPolicyState
name: Get-AzPolicyState
description: |-
  Gets policy compliance states for resources. Policy state records can be queried at various scopes. Based on the time interval specified (defaults to last day), either latest policy states or all policy state transitions can be queried. Results can be filtered, grouped, and group aggregations can be computed.
metadata:
  external help file: Microsoft.Azure.PowerShell.Cmdlets.PolicyInsights.dll-Help.xml
  Module Name: Az.PolicyInsights
  online version: https://docs.microsoft.com/en-us/powershell/module/az.policyinsights/get-azpolicystate
  schema: 2.0.0
  content_git_url: https://github.com/Azure/azure-powershell/blob/master/src/PolicyInsights/PolicyInsights/help/Get-AzPolicyState.md
  original_content_git_url: https://github.com/Azure/azure-powershell/blob/master/src/PolicyInsights/PolicyInsights/help/Get-AzPolicyState.md
