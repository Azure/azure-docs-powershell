### YamlMime:PowershellCmdlet
summary: |-
  Adds a secret to a virtual machine.
module: Az.Compute
notes: ""
inputs:
- name: <xref href="Microsoft.Azure.Commands.Compute.Models.PSVirtualMachine" data-throw-if-not-resolved="False" />
  description: ""
- name: <xref href="System.String" data-throw-if-not-resolved="False" />
  description: ""
outputs:
- name: <xref href="Microsoft.Azure.Commands.Compute.Models.PSVirtualMachine" data-throw-if-not-resolved="False" />
  description: ""
links:
- text: Get-AzVM
  href: ./Get-AzVM.yml
- text: New-AzVMConfig
  href: ./New-AzVMConfig.yml
- text: Set-AzVMOperatingSystem
  href: ./Set-AzVMOperatingSystem.yml
syntaxes:
- >-
  Add-AzVMSecret [-VM] <PSVirtualMachine> [[-SourceVaultId] <String>] [[-CertificateStore] <String>]

   [[-CertificateUrl] <String>] [-DefaultProfile <IAzureContextContainer>] [<CommonParameters>]
examples:
- title: 'Example 1: Add a secret to a virtual machine'
  code: |-
    PS C:\> $VirtualMachine = New-AzVMConfig -VMName "VirtualMachine07" -VMSize "Standard_A1" -AvailabilitySetID $AvailabilitySet.Id
    PS C:\> $Credential = Get-Credential
    PS C:\> $VirtualMachine = Set-AzVMOperatingSystem -VM $VirtualMachine  -Windows -ComputerName "Contoso26" -Credential $Credential
    PS C:\> $SourceVaultId = "/subscriptions/46f8cea4-2de6-4179-8ab1-365da4211af4/resourceGroups/vault/providers/Microsoft.KeyVault/vaults/keyvault"
    PS C:\> $CertificateStore01 = "My"
    PS C:\> $CertificateUrl01 = "https://contosovault.vault.azure.net/secrets/514ceb769c984379a7e0230bdd703272"
    PS C:\> $VirtualMachine = Add-AzVMSecret -VM $VirtualMachine -SourceVaultId $SourceVaultId -CertificateStore $CertificateStore01 -CertificateUrl $CertificateUrl01
  description: |-
    The first command creates a virtual machine object, and then stores it in the $VirtualMachine variable.
    The command assigns a name and size to the virtual machine.
    The second command creates a credential object by using the Get-Credential cmdlet, and then stores the result in the $Credential variable.
    The command prompts you for a user name and password.
    For more information, type `Get-Help Get-Credential`.
    The third command uses the **Set-AzVMOperatingSystem** cmdlet to configure the virtual machine stored in $VirtualMachine.
    The fourth command assigns a source vault ID to the $SourceVaultId variable for later use.
    The command assumes that the $SubscriptionId variable has an appropriate value.
    The fifth command assigns a value to the $CertificateStore01 variable for later use.
    The sixth command assigns a URL for a certificate store.
    The seventh command adds a secret to the virtual machine stored in $VirtualMachine.
    The SourceVaultId parameter specifies the Key Vault.
    The command specifies the name of the certificate store and the URL of the certificate.
    You can run the **Add-AzVMSecret** repeatedly to add secrets for other certificates.
  summary: ""
parameters:
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: CertificateStore
  description: |+
    Specifies the name of a certificate store on the virtual machine that runs the Windows operating system.
    This cmdlet adds the certificate to the store that this parameter specifies.
    You can only specify this parameter for virtual machines that run the Windows operating system.

  defaultValue: None
  pipelineInput: true
  position: "2"
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: CertificateUrl
  description: |+
    Specifies the URL that points to a Key Vault secret which contains a certificate.
    The certificate is the Base64 encoding of the following JavaScript Object Notation (JSON) object, which is encoded in UTF-8:
    {
    "data": "\<Base64-encoded-file\>",
    "dataType": "\<file-format\>",
    "password": "\<pfx-file-password\>"
    }
    Currently, dataType accepts only .pfx files.

  defaultValue: None
  pipelineInput: true
  position: "3"
  aliases: ""
  parameterValueGroup: ""
- type: <xref href="Microsoft.Azure.Commands.Common.Authentication.Abstractions.Core.IAzureContextContainer" data-throw-if-not-resolved="False" />
  name: DefaultProfile
  description: |+
    The credentials, account, tenant, and subscription used for communication with azure.

  defaultValue: None
  position: Named
  aliases: AzContext, AzureRmContext, AzureCredential
  parameterValueGroup: ""
- type: <xref href="System.String" data-throw-if-not-resolved="False" />
  name: SourceVaultId
  description: |+
    Specifies the resource ID of the Key Vault that contains the certificates that you can add to the virtual machine.
    This value also acts as the key for adding multiple certificates.
    This means that you can use the same value for *SourceVaultId* when you add multiple certificates from the same Key Vault.

  defaultValue: None
  pipelineInput: true
  position: "1"
  aliases: Id
  parameterValueGroup: ""
- type: <xref href="Microsoft.Azure.Commands.Compute.Models.PSVirtualMachine" data-throw-if-not-resolved="False" />
  name: VM
  isRequired: true
  description: |+
    Specifies the virtual machine object that this cmdlet modifies.
    To obtain a virtual machine object, use the [Get-AzVM](./Get-AzVM.yml) cmdlet.
    You can use the [New-AzVMConfig](./New-AzVMConfig.yml) cmdlet to create a virtual machine object.

  defaultValue: None
  pipelineInput: true
  position: "0"
  aliases: VMProfile
  parameterValueGroup: ""
uid: Az.Compute.Add-AzVMSecret
name: Add-AzVMSecret
description: |-
  The **Add-AzVMSecret** cmdlet adds a secret to a virtual machine.
  This value lets you add a certificate to the virtual machine.
  The secret must be stored in a Key Vault.
  For more information about Key Vault, see [What is Azure Key Vault?](https://azure.microsoft.com/en-us/documentation/articles/key-vault-whatis/).
  For more information about the cmdlets, see [Azure Key Vault Cmdlets](/powershell/module/az.keyvault) or the [Set-AzKeyVaultSecret](/powershell/module/az.keyvault/set-azkeyvaultsecret) cmdlet.
metadata:
  external help file: Microsoft.Azure.PowerShell.Cmdlets.Compute.dll-Help.xml
  Module Name: Az.Compute
  ms.assetid: 5008F83F-AF3E-47CF-99A3-55129E654128
  online version: https://docs.microsoft.com/en-us/powershell/module/az.compute/add-azvmsecret
  schema: 2.0.0
  content_git_url: https://github.com/Azure/azure-powershell/blob/master/src/Compute/Compute/help/Add-AzVMSecret.md
  original_content_git_url: https://github.com/Azure/azure-powershell/blob/master/src/Compute/Compute/help/Add-AzVMSecret.md
